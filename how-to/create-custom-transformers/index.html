<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Create custom transformers - HEADFAKE</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../../css/theme.css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  <link href="//use.fontawesome.com/releases/v5.8.1/css/all.css" rel="stylesheet" />
  <link href="//use.fontawesome.com/releases/v5.8.1/css/v4-shims.css" rel="stylesheet" />
  <link href="../../css/mkapi-common.css" rel="stylesheet" />
  <link href="../../css/mkapi-readthedocs.css" rel="stylesheet" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Create custom transformers";
    var mkdocs_page_input_path = "how-to/create-custom-transformers.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> HEADFAKE</a>
        
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../installation/">Installation</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../usage/">Usage</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Tutorials</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../tutorials/tutorial1/">1. Generating fake data files</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../tutorials/tutorial2/">2. Templates and conditional logic</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../tutorials/tutorial3/">3. Lookups and transformers</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Discussion</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../discussion/initialising-headfake/">Initialising Headfake</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">How to..</span></p>
                <ul class="current">
                    <li class="toctree-l1"><a class="reference internal" href="../create-custom-fields/">Create custom fields</a>
                    </li>
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">Create custom transformers</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#an-example-transformer">An example transformer</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#using-custom-transformers-in-yaml-templates">Using custom transformers in YAML templates</a>
    </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../add-a-lookup-field/">Add a lookup field</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">API</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../api/headfake/">headfake</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="#">field</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../api/field/core/">core</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../api/field/id/">id</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../api/field/faker/">faker</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../api/field/derived/">derived</a>
                </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../api/cli/">cli</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../api/fieldset/">fieldset</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../api/transformer/">transformer</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../api/output/">output</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../api/error/">error</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../api/util/">util</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">HEADFAKE</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>How to.. &raquo;</li>
        
      
    
    <li>Create custom transformers</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/rcfgroup/headfake/edit/master/docs/how-to/create-custom-transformers.md"> Edit on headfake</a>
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="create-custom-transformers">Create custom transformers</h1>
<p>A transformer a special class which acts before or after the data is generated from a field.</p>
<p>Custom transformers can be created by extending the Transformer class in headfake.transformer. If you want to allow parameters to be passed to your transformer Headfake they should be setup using the approaches documented in the <a href="https://www.attrs.org">attrs</a> package, which provides a simpler way of initialising and handling class properties.</p>
<h2 id="an-example-transformer">An example transformer</h2>
<p>Below is a simple transformer which splits a string by a 'separator' to create a list and returns the piece from this list specified by 'index'. Each of these parameters can be specified by the user.</p>
<p>An example of how this could be used would be generating a partial UK postcode - you want to create a column containing just the first part of it (e.g. the AB1 from AB1 2CD).</p>
<div class="codehilite"><pre><span></span><code><span class="nd">@attr</span><span class="o">.</span><span class="n">s</span><span class="p">(</span><span class="n">kw_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">headfake.transformer</span> <span class="kn">import</span> <span class="n">Transformer</span>

<span class="k">class</span> <span class="nc">SplitPiece</span><span class="p">(</span><span class="n">Transformer</span><span class="p">):</span>
    <span class="n">separator</span> <span class="o">=</span> <span class="n">attr</span><span class="o">.</span><span class="n">ib</span><span class="p">()</span> <span class="c1">#string to separator on</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">attr</span><span class="o">.</span><span class="n">ib</span><span class="p">()</span> <span class="c1">#index of separated string to return</span>

    <span class="k">def</span> <span class="nf">after_next</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">pieces</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">separator</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pieces</span><span class="p">)</span><span class="o">&lt;</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;&quot;</span>

        <span class="k">return</span> <span class="n">pieces</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>

<span class="o">..</span>

<span class="n">postcode_field</span> <span class="o">=</span> <span class="n">PostcodeField</span><span class="p">(</span><span class="n">transformers</span><span class="o">=</span><span class="p">[</span>
    <span class="n">SplitPiece</span><span class="p">(</span><span class="n">separator</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="p">])</span>
</code></pre></div>

<h2 id="using-custom-transformers-in-yaml-templates">Using custom transformers in YAML templates</h2>
<p>This is as simple as entering the classname in the 'class' property in the YAML file along with the additional parameters. For example to use the SplitPieceTransformer in a field:</p>
<div class="codehilite"><pre><span></span><code><span class="nn">...</span>
<span class="nt">postcode</span><span class="p">:</span>
    <span class="nt">class</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">headfake.field.PostcodeField</span>
    <span class="nt">transformers</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">class</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mypackage.SplitPieceTransformer</span>
          <span class="nt">separator</span><span class="p">:</span> <span class="s">&quot;</span><span class="nv"> </span><span class="s">&quot;</span>
          <span class="nt">index</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0</span>
<span class="nn">...</span>
</code></pre></div>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../add-a-lookup-field/" class="btn btn-neutral float-right" title="Add a lookup field">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../create-custom-fields/" class="btn btn-neutral" title="Create custom fields"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../create-custom-fields/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../add-a-lookup-field/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../js/mkapi.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
